{% extends "admin/admin_base.html" %}

{% block title %}{{ title }} - Kaystreet Management{% endblock %}

{% block content %}
<div class="admin-content">
    <!-- Page Header -->
    <div class="admin-page-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="admin-page-title">
                    <i class="fas fa-book"></i>
                    {{ title }}
                </h1>
                <p class="admin-page-subtitle text-muted">
                    {% if regulation %}
                        Edit comprehensive regulation details and compliance information
                    {% else %}
                        Create new regulation with comprehensive compliance tracking
                    {% endif %}
                </p>
            </div>
            <div class="admin-header-actions">
                <a href="{{ url_for('admin.manage_regulations') }}" class="btn btn-admin-secondary">
                    <i class="fas fa-arrow-left me-2"></i> Back to Regulations
                </a>
            </div>
        </div>
    </div>

    <!-- Form Card -->
    <div class="admin-form-card">
        <div class="admin-form-header">
            <h5 class="admin-form-title">
                <i class="fas fa-edit"></i>
                Comprehensive Regulation Details
            </h5>
            <p class="admin-form-subtitle">
                Complete all required fields marked with <span class="text-danger">*</span> to ensure proper compliance tracking
            </p>
        </div>
        <div class="admin-form-body">
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <!-- Core Information Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-info-circle"></i> Core Information
                    </h6>
                    <p class="form-section-description">
                        Basic regulation details and jurisdiction information
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.jurisdiction_level.label(class="admin-form-label required") }}
                                {{ form.jurisdiction_level(class="admin-form-select") }}
                                <small class="form-text text-muted">{{ form.jurisdiction_level.description }}</small>
                                {% if form.jurisdiction_level.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.jurisdiction_level.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.location.label(class="admin-form-label required") }}
                                {{ form.location(class="admin-form-input") }}
                                <small class="form-text text-muted">{{ form.location.description }}</small>
                                {% if form.location.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.location.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-form-group">
                        {{ form.title.label(class="admin-form-label required") }}
                        {{ form.title(class="admin-form-input") }}
                        <small class="form-text text-muted">{{ form.title.description }}</small>
                        {% if form.title.errors %}
                            <div class="admin-form-error">
                                {% for error in form.title.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="admin-form-group">
                        {{ form.key_requirements.label(class="admin-form-label required") }}
                        {{ form.key_requirements(class="admin-form-textarea") }}
                        <small class="form-text text-muted">{{ form.key_requirements.description }}</small>
                        {% if form.key_requirements.errors %}
                            <div class="admin-form-error">
                                {% for error in form.key_requirements.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Compliance Details Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-shield-alt"></i> Compliance Details
                    </h6>
                    <p class="form-section-description">
                        Compliance requirements, property applicability, and enforcement status
                    </p>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="admin-form-group">
                                {{ form.compliance_level.label(class="admin-form-label required") }}
                                {{ form.compliance_level(class="admin-form-select") }}
                                <small class="form-text text-muted">{{ form.compliance_level.description }}</small>
                                {% if form.compliance_level.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.compliance_level.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="admin-form-group">
                                {{ form.status.label(class="admin-form-label required") }}
                                {{ form.status(class="admin-form-select") }}
                                <small class="form-text text-muted">{{ form.status.description }}</small>
                                {% if form.status.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.status.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="admin-form-group">
                                {{ form.last_updated.label(class="admin-form-label") }}
                                {{ form.last_updated(class="admin-form-input") }}
                                <small class="form-text text-muted">{{ form.last_updated.description }}</small>
                                {% if form.last_updated.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.last_updated.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-form-group">
                        {{ form.property_types.label(class="admin-form-label") }}
                        {{ form.property_types(class="admin-form-input") }}
                        <small class="form-text text-muted">{{ form.property_types.description }}</small>
                        {% if form.property_types.errors %}
                            <div class="admin-form-error">
                                {% for error in form.property_types.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Metadata & Classification Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-tags"></i> Classification & Metadata
                    </h6>
                    <p class="form-section-description">
                        Category classification, priority level, and searchability keywords
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.category.label(class="admin-form-label required") }}
                                {{ form.category(class="admin-form-select") }}
                                <small class="form-text text-muted">{{ form.category.description }}</small>
                                {% if form.category.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.category.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.priority.label(class="admin-form-label required") }}
                                {{ form.priority(class="admin-form-select") }}
                                <small class="form-text text-muted">{{ form.priority.description }}</small>
                                {% if form.priority.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.priority.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-form-group">
                        {{ form.related_keywords.label(class="admin-form-label") }}
                        {{ form.related_keywords(class="admin-form-input") }}
                        <small class="form-text text-muted">{{ form.related_keywords.description }}</small>
                        {% if form.related_keywords.errors %}
                            <div class="admin-form-error">
                                {% for error in form.related_keywords.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Compliance Checklist Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-clipboard-check"></i> Compliance Checklist
                    </h6>
                    <p class="form-section-description">
                        Specific actionable items and compliance requirements for property owners
                    </p>
                    
                    <div class="admin-form-group">
                        {{ form.compliance_checklist.label(class="admin-form-label") }}
                        {{ form.compliance_checklist(class="admin-form-textarea") }}
                        <small class="form-text text-muted">{{ form.compliance_checklist.description }}</small>
                        <div class="form-text">
                            <strong>Tip:</strong> Use bullet points (•) or numbered lists for better readability
                        </div>
                        {% if form.compliance_checklist.errors %}
                            <div class="admin-form-error">
                                {% for error in form.compliance_checklist.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Contact Information Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-address-book"></i> Contact Information
                    </h6>
                    <p class="form-section-description">
                        Local authority contact details for compliance questions and applications
                    </p>
                    
                    <div class="admin-form-group">
                        {{ form.local_authority_contact.label(class="admin-form-label") }}
                        {{ form.local_authority_contact(class="admin-form-textarea") }}
                        <small class="form-text text-muted">{{ form.local_authority_contact.description }}</small>
                        <div class="form-text">
                            <strong>Format suggestion:</strong> Department name, phone, email, address (one per line)
                        </div>
                        {% if form.local_authority_contact.errors %}
                            <div class="admin-form-error">
                                {% for error in form.local_authority_contact.errors %}
                                    <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Date Information Section -->
                <div class="form-section">
                    <h6 class="form-section-title">
                        <i class="fas fa-calendar-alt"></i> Date Information
                    </h6>
                    <p class="form-section-description">
                        Important dates for regulation effectiveness and expiration
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.effective_date.label(class="admin-form-label") }}
                                {{ form.effective_date(class="admin-form-input") }}
                                <small class="form-text text-muted">{{ form.effective_date.description }}</small>
                                {% if form.effective_date.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.effective_date.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                {{ form.expiry_date.label(class="admin-form-label") }}
                                {{ form.expiry_date(class="admin-form-input") }}
                                <small class="form-text text-muted">{{ form.expiry_date.description }}</small>
                                {% if form.expiry_date.errors %}
                                    <div class="admin-form-error">
                                        {% for error in form.expiry_date.errors %}
                                            <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legacy Fields Section (Collapsible) -->
                <div class="form-section legacy-section">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="form-section-title">
                            <i class="fas fa-archive"></i> Legacy Fields
                        </h6>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#legacyFields" aria-expanded="false" aria-controls="legacyFields">
                            <i class="fas fa-chevron-down"></i> Show/Hide
                        </button>
                    </div>
                    <p class="form-section-description">
                        Legacy fields maintained for backward compatibility. Use corresponding new fields above instead.
                    </p>
                    
                    <div class="collapse" id="legacyFields">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    {{ form.property_type.label(class="admin-form-label") }}
                                    {{ form.property_type(class="admin-form-input") }}
                                    <small class="form-text text-muted">{{ form.property_type.description }}</small>
                                    {% if form.property_type.errors %}
                                        <div class="admin-form-error">
                                            {% for error in form.property_type.errors %}
                                                <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="admin-form-group">
                                    {{ form.keywords.label(class="admin-form-label") }}
                                    {{ form.keywords(class="admin-form-input") }}
                                    <small class="form-text text-muted">{{ form.keywords.description }}</small>
                                    {% if form.keywords.errors %}
                                        <div class="admin-form-error">
                                            {% for error in form.keywords.errors %}
                                                <div><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="admin-form-actions">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="form-help-text">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Fields marked with <span class="text-danger">*</span> are required for proper compliance tracking
                            </small>
                        </div>
                        <div class="action-buttons">
                            <a href="{{ url_for('admin.manage_regulations') }}" class="btn btn-admin-secondary me-2">
                                <i class="fas fa-times me-1"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-admin-primary">
                                <i class="fas fa-save me-1"></i> 
                                {% if regulation %}Update{% else %}Create{% endif %} Regulation
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Enhanced form styling */
.form-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border-left: 4px solid #007bff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form-section-title {
    color: #007bff;
    margin-bottom: 0.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-section-description {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    font-style: italic;
}

.admin-form-label.required::after {
    content: " *";
    color: #dc3545;
    font-weight: bold;
}

.legacy-section {
    border-left-color: #6c757d;
    background: #f1f3f4;
}

.legacy-section .form-section-title {
    color: #6c757d;
}

.admin-form-actions {
    background: #fff;
    border-radius: 8px;
    padding: 1.5rem;
    border: 1px solid #dee2e6;
    margin-top: 2rem;
}

.form-help-text {
    flex: 1;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Enhanced field styling */
.admin-form-textarea {
    min-height: 120px;
    resize: vertical;
}

.form-text {
    font-size: 0.8rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.form-text strong {
    color: #495057;
}

/* Responsive improvements */
@media (max-width: 768px) {
    .admin-form-actions .d-flex {
        flex-direction: column;
        gap: 1rem;
    }
    
    .action-buttons {
        width: 100%;
        justify-content: stretch;
    }
    
    .action-buttons .btn {
        flex: 1;
    }
}
</style>

<script>
// Auto-save draft functionality (optional enhancement)
document.addEventListener('DOMContentLoaded', function() {
    // Add any JavaScript enhancements here
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input, textarea, select');
    
    // Auto-resize textareas
    inputs.forEach(input => {
        if (input.tagName === 'TEXTAREA') {
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }
    });
});
</script>
{% endblock %}
